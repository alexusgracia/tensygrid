<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>dmsim</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-06-24">
<meta name="DC.source" content="dmsimDoc.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>dmsim</h1>
<!--introduction-->
<p>simulated response of implicit/descriptor multilinear time invariant (iMTI) system to arbitrary input signals</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Syntax</a>
</li>
<li>
<a href="#2">Description</a>
</li>
<li>
<a href="#3">Examples</a>
</li>
<li>
<a href="#32">References</a>
</li>
<li>
<a href="#33">See Also</a>
</li>
</ul>
</div>
<h2 id="1">Syntax</h2>
<p>simout = dmsim(sys, x0) Simulated time response of autonomous iMTI system for the time fram from 0 to 10 and initial states x0.</p>
<p>simout = dmsim(sys, x0, ut) Simulated time response of autonomous iMTI system for the time frame of ut and initial states x0.</p>
<p>simout = dmsim(sys, x0, ut, u) Simulated time response of iMTI system with arbitrary input signals u (linear interpolated) at the time steps of ut and initial states x0. For continuous-time simulation use default ode-settings from Matlab.</p>
<p>simout = dmsim(sys, x0, ut, u, opt) Simulated time response of iMTI system with arbitrary input signals u (linear interpolated) at the time steps of ut and initial states x0, with using the ode-settings opt (defined with opt = odeset()). Only used for continuous-time simulation.</p>
<h2 id="2">Description</h2>
<p>The dmsim class serves as simulation class for implicit/descriptor multilinear time invariant (iMTI) models. Only differential index-1 systems are usable. The simulation will be performed automatically when creating a dmsim object by simout = dmsim(sys, x0, ut, u).</p>
<p>For continuous-time simulations Matlabs implementation of the variable order method ode15i() will be used. For discrete-time simulations an automated tearing approach will be used, described in [1], where the set of equations will be split into multiple subsets and explicit solvable subsets of equations will be identified, as well as implicit solvable subsets. For reordering the sparsity pattern, Matlabs implementation of the dulmage-mendelsohn decomposition dmperm() is used. The implicit solvable subsets will be solved using the Levenberg-Marquardt algorithm implementation of Matlabs nonlinear least-squares solver lsqnonlin().</p>
<h2 id="3">Examples</h2>
<p>
<b>Autonomous continuous-time simulation (including ode-settings): Sprott B Attractor</b>
</p>
<p>In [2] J. C. Sprott proposed chaotic attractor named Sprott A-S systems. The Sprott B attractor is described by the following differential equations</p>
<pre class="codeinput">eq = [<span class="string">"dx1 = a*x2*x3"</span>;<span class="keyword">...</span>
    <span class="string">"dx2 = x1 - b*x2"</span>;<span class="keyword">...</span>
    <span class="string">"dx3 = c - x1*x2"</span>];
</pre>
<p>The dmss model can be directly generated using the symbolic equations by</p>
<pre class="codeinput">Ts = 0;
sys = sym2dmss(eq, Ts, [<span class="string">"dx"</span>, <span class="string">"x"</span>, <span class="string">"u"</span>, <span class="string">"y"</span>]);
</pre>
<p>where the timestep size is 0 for continuous time systems. Also it can be generated using the cpn-1 tensor format. Therefor first an empty hyCPN1() object needs to be generated, so its properties are accessable.</p>
<pre class="codeinput">Ts = 0;
H = hyCPN1();
H.F.stateDerivative  = [1 0 0 0 0 0 0 0;<span class="keyword">...</span>
                        0 1 0 0 0 0 0 0;<span class="keyword">...</span>
                        0 0 1 0 0 0 0 0];
H.F.state = [0 0 0 0 1 0 0 1;<span class="keyword">...</span>
             0 0 0 1 0 1 0 1;<span class="keyword">...</span>
             0 0 0 1 0 0 0 0];
H.phi.equality =   [-1 0 0 sym(<span class="string">"a"</span>) 0 0 0 0;<span class="keyword">...</span>
                    0 -1 0 0 1 -sym(<span class="string">"b"</span>) 0 0;<span class="keyword">...</span>
                    0 0 -1 0 0 0 sym(<span class="string">"c"</span>) -1];
sys = dmss(H,Ts);
</pre>
<p>The equations can be displayed by</p>
<pre class="codeinput">disp(sys.symbolicEquations)
</pre>
<pre class="codeoutput">  a*x2*x3 - xp1 == 0
x1 - xp2 - b*x2 == 0
c - xp3 - x1*x2 == 0
 
</pre>
<p>where <img src="dmsimDoc_eq03728620088983410552.png" alt="$xp_i$" style="width:19px;height:10px;"> are the state derivatives, <img src="dmsimDoc_eq05043059182872985900.png" alt="$x_i$" style="width:11px;height:9px;"> are states (differential variables), <img src="dmsimDoc_eq14675076360472238679.png" alt="$y_i$" style="width:10px;height:10px;"> are algebriac variables and <img src="dmsimDoc_eq16212169613327207076.png" alt="$u_i$" style="width:11px;height:9px;"> are input signals.</p>
<p>For this example the parameters</p>
<pre class="codeinput">params = [sym(<span class="string">"a"</span>), sym(<span class="string">"b"</span>), sym(<span class="string">"c"</span>)];
</pre>
<p>are defined as</p>
<pre class="codeinput">numParams = [0.4, 1.2, 1];
</pre>
<p>The symbolic parameter values must be replace by the numeric parameter values for the simulation.</p>
<pre class="codeinput">sys = sys.replaceSymbolicParameters(params, numParams);
</pre>
<p>The Equations can be checked again by</p>
<pre class="codeinput">disp(sys.symbolicEquations)
</pre>
<pre class="codeoutput">  (2*x2*x3)/5 - xp1 == 0
x1 - (6*x2)/5 - xp2 == 0
    1 - x1*x2 - xp3 == 0
 
</pre>
<p>Now the simulation can be done with creating a dmsim object with the dmss model as input, as well as initial states and a simulation time frame:</p>
<pre class="codeinput">t = [0, 1e3];
x0 = [0.1, 0, 0];
opt = odeset(<span class="string">'RelTol'</span>, 10.0^(-3),<span class="string">'AbsTol'</span>,10.0^(-7));
simout = dmsim(sys, x0, t, [], opt);
</pre>
<pre class="codeoutput">Seperation in 3 subset(s) with 3 subproblem(s), from which 3 are explicit solvable.</pre>
<p>The simulation results can be accessed as the properties of the simulation object. Then the phase space can be portraited by Matlabs ploting functions</p>
<pre class="codeinput">plot3(simout.x(:,1), simout.x(:,2), simout.x(:,3))
grid <span class="string">on</span>
</pre>
<img vspace="5" hspace="5" src="dmsimDoc_01.png" alt=""> <p>
<b>Continuous-time simulation with algebraic constraint: robertson problem</b>
</p>
<p>The robertson problem can be written as a system of DAEs, which gives</p>
<pre class="codeinput">eq = [<span class="string">"0 = dx1 + 0.04*x1 - 10^4*x2*y1"</span>;<span class="keyword">...</span>
    <span class="string">"0 = dx2 - 0.04*x1 + 10^4*x2*y1 + (3*10^7)*x2^2"</span>;<span class="keyword">...</span>
    <span class="string">"0 = x1 + x2 + y1 - 1"</span>]
</pre>
<pre class="codeoutput">
eq = 

  3&times;1 string array

    "0 = dx1 + 0.04*x1 - 10^4*x2*y1"
    "0 = dx2 - 0.04*x1 + 10^4*x2*y1 + (3*10^7)*x2^2"
    "0 = x1 + x2 + y1 - 1"

</pre>
<p>As before the symbolic system of equations can be transfered into a dmss object by</p>
<pre class="codeinput">Ts = 0;
sys = sym2dmss(eq, Ts, [<span class="string">"dx"</span>, <span class="string">"x"</span>, <span class="string">"u"</span>, <span class="string">"y"</span>]);
disp(sys.symbolicEquations)
</pre>
<pre class="codeoutput">Reduced by 4 column(s) and 0 equation(s) with trivial Reduction due to duplications.
                 10000*x2*y1 - xp1 - x1/25 == 0
x1/25 - xp2 - 10000*x2*y1 - 30000000*x2*y2 == 0
                          1 - x2 - y1 - x1 == 0
                                   y2 - x2 == 0
 
</pre>
<p>where <img src="dmsimDoc_eq03728620088983410552.png" alt="$xp_i$" style="width:19px;height:10px;"> are the state derivatives, <img src="dmsimDoc_eq05043059182872985900.png" alt="$x_i$" style="width:11px;height:9px;"> are states (differential variables), <img src="dmsimDoc_eq14675076360472238679.png" alt="$y_i$" style="width:10px;height:10px;"> are algebriac variables and <img src="dmsimDoc_eq16212169613327207076.png" alt="$u_i$" style="width:11px;height:9px;"> are input signals. One can see that an auxiliary variable <img src="dmsimDoc_eq05993124288263538233.png" alt="$y_2$" style="width:12px;height:10px;"> and an according had been added due to the quadratic term.</p>
<p>Simulation can be performed by creating a dmsim object</p>
<pre class="codeinput">t = [0, 4e6];
x0 = [1, 0];
simout = dmsim(sys, x0, t);

semilogx(simout.tsim, simout.x(:,1))
hold <span class="string">on</span>
semilogx(simout.tsim, simout.x(:,2))
semilogx(simout.tsim, simout.y(:,1))
grid <span class="string">on</span>
hold <span class="string">off</span>
</pre>
<pre class="codeoutput">Seperation in 1 subset(s) with 4 subproblem(s), from which 4 are explicit solvable.</pre>
<img vspace="5" hspace="5" src="dmsimDoc_02.png" alt=""> <p>
<b>Continuous-time example with inputs: Simplified room model of an air conditioning system</b>
</p>
<p>HVAC systems can be modeled by dynamic energy balances (power/heat flow balances) and dynamic transport balances. The dynamics of the air temperature, enthalpy and humidity of an air conditioned room can be represented by the following power balance</p>
<pre class="codeinput">powerBalance = [<span class="string">"0 = -m*dh1 + p1 + p2"</span>];
</pre>
<p>transport balance of the water vapor in the air</p>
<pre class="codeinput">transportBalance = [<span class="string">"0 = -m*dh2 + p3"</span>];
</pre>
<p>and equation for the specific enthalpy</p>
<pre class="codeinput">enthalpy = [<span class="string">"h1 = c_d * T1 + c_v * T1 * h2 + r0 * h2"</span>];
</pre>
<p>where h1 is the room air enthalpy, h2 is the absolute room air humidity, dh1 and dh2 are their derivatives, T1 is the room temperature, p1 is the power transported by the air flow of the air conditioning system (either heating or cooling the room air), p2 is the heat loss to the environment and p3 is the water vapor mass flow transported by the air flow of the air conditioning system (either humidifying or dehumidifying the room air).</p>
<p>The equations can be converted into a continuous time iMTI model by</p>
<pre class="codeinput">room = sym2dmss([powerBalance; transportBalance; enthalpy], 0, [<span class="string">"dh"</span>, <span class="string">"h"</span>, <span class="string">"p"</span>, <span class="string">"T"</span>]);
</pre>
<p>The equations represented by the model can be viewed by</p>
<pre class="codeinput">disp(room.symbolicEquations)
</pre>
<pre class="codeoutput">                m*xp1 - u2 - u1 == 0
                     m*xp2 - u3 == 0
x1 - c_d*y1 - r0*x2 - c_v*x2*y1 == 0
 
</pre>
<p>where <img src="dmsimDoc_eq03728620088983410552.png" alt="$xp_i$" style="width:19px;height:10px;"> are the state derivatives, <img src="dmsimDoc_eq05043059182872985900.png" alt="$x_i$" style="width:11px;height:9px;"> are states (differential variables), <img src="dmsimDoc_eq14675076360472238679.png" alt="$y_i$" style="width:10px;height:10px;"> are algebriac variables and <img src="dmsimDoc_eq16212169613327207076.png" alt="$u_i$" style="width:11px;height:9px;"> are input signals.</p>
<p>A model for the heat and water vapor transfer by the air conditioning system can be generated by</p>
<pre class="codeinput">airConditioning = [<span class="string">"y1 = c_d*u1*u2 + c_v*u1*u2*u3 + r0*u1*u3 - u1*u4"</span>;<span class="keyword">...</span>
                    <span class="string">"y2 = u1*u3 - u1*u5"</span>];
airConditioning = sym2dmss(airConditioning, 0, [<span class="string">"dx"</span>, <span class="string">"x"</span>, <span class="string">"u"</span>, <span class="string">"y"</span>]);
</pre>
<pre class="codeoutput">Reduced by 1 column(s) and 0 equation(s) with trivial Reduction due to duplications.
</pre>
<p>where y1 corresponds to the power transported by the air flow of the air conditioning system, y2 to the water vapor mass flow transported by the air flow of the air conditioning system, u1 to the supplied mass flow of air, u2 to the supply temperature, u3 to the supply humidity, u4 to the rooms enthalpy and u5 to the rooms absolute humidity.</p>
<p>Additionally the heat loss can be modelled by</p>
<pre class="codeinput">loss = [<span class="string">"y1 = k*A*(u1-u2)"</span>];
loss = sym2dmss(loss, 0, [<span class="string">"dx"</span>, <span class="string">"x"</span>, <span class="string">"u"</span>, <span class="string">"y"</span>]);
</pre>
<p>where y1 is the heat loss, u1 is the ambient temperature and u2 is the rooms temperature.</p>
<p>The models can be connected in two ways. One way is using index matrices of input-state, input-algebraic and input-input connections. Therefore one of the models must be appended by the others. This can be done by</p>
<pre class="codeinput">sys = append(room, airConditioning, loss);
</pre>
<p>Due to the appending the number of variables of the overall model as well as their index is increasing accordingly. The connection matrices must be produced carefully, where the first column corresponds to the input index and the second column to the state/algebraic signal index.</p>
<pre class="codeinput">stateInputConnection = [7 1; 8 2];
algebraicInputConnection = [9 1; 1 2; 3 3; 2 4];
similarInputs = [];
sys = sys.connect(stateInputConnection, algebraicInputConnection, [], similarInputs);

disp(sys.symbolicEquations)
</pre>
<pre class="codeoutput">Reduced by 4 column(s) and 0 equation(s) with trivial Reduction due to duplications.
                                 m*xp1 - y4 - y2 == 0
                                      m*xp2 - y3 == 0
                 x1 - c_d*y1 - r0*x2 - c_v*x2*y1 == 0
y2 + u1*x1 - c_d*u1*u2 - r0*u1*u3 - c_v*u1*u2*u3 == 0
                              y3 - u1*u3 + u1*x2 == 0
                            y4 + A*k*u4 - A*k*y1 == 0
 
</pre>
<p>Another possibility is by automatic connection by variable names, where the connection matrices will be produced automatically by identifying similar variable names of state and inputs, algebraic variables and inputs, as well as inputs and inputs.</p>
<p>For simulation the symbolic parameters must be replaced by numeric parameters.</p>
<pre class="codeinput">symParameters = [sym(<span class="string">"m"</span>), sym(<span class="string">"c_d"</span>), sym(<span class="string">"c_v"</span>), sym(<span class="string">"r0"</span>), sym(<span class="string">"A"</span>), sym(<span class="string">"k"</span>)];
numParameters = [9.03*11.33*3.4*1.225, 1006, 1860, 2501*10^3, 2*(9.03+11.33)*3.4 + 9.03*11.33, 3];
sys = sys.replaceSymbolicParameters(symParameters, numParameters);
</pre>
<p>The overall system can now be simulated with according input signals</p>
<pre class="codeinput">t = [0:1:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);
</pre>
<p>where the initial state correspond to an initial room enthalpy of 75 kJ/kg and initial aboslute humidity of 18 g water vapor per kg dry air, and the (noisy) inputs correspond to an air flow of 500m&sup3;/h, supply temperature of 16&deg;C, supply humidity of 10 g/kg and ambient temperature of 32&deg;C. Simulation will be performed by</p>
<pre class="codeinput">simout = dmsim(sys, x0, t, u);

plot(simout.tsim, simout.y(:,1))
hold <span class="string">on</span>
plot(simout.tsim, simout.x(:,2)*1e3)
legend([<span class="string">"room temperature in &deg;C"</span>, <span class="string">"room abs. humidity in kg/kg"</span>])
grid <span class="string">on</span>
axis([0 60 0 35])
hold <span class="string">off</span>
</pre>
<pre class="codeoutput">Seperation in 1 subset(s) with 6 subproblem(s), from which 6 are explicit solvable.</pre>
<img vspace="5" hspace="5" src="dmsimDoc_03.png" alt=""> <p>For fast varying inputs it often makes sense to limit the maximum stepsize of the ode-solver, e.g. by opt = odeset('MaxStep', ts/2) where ts is the minimum step size between the inputs.</p>
<p>
<b>Discrete-time simulation using c2d</b>
</p>
<p>The previuous system can transformed into a discrete-time iMTI model by using the c2d() function implemented for the dmss object, using one step forward euler discretization.</p>
<pre class="codeinput">Ts = 5;
sys_d = sys.c2d(Ts);
</pre>
<pre class="codeoutput">System reduced algebraicly by 2 algebraic variable(s) and 2 equation(s).
</pre>
<p>Discrete-time simulation can be done similary to continuous-time simulation by creating a dmsim object. But here its important that the time vector for the input signal has the same stepsize as the stepsize of the model.</p>
<pre class="codeinput">t = [0:Ts:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);

sim_d = dmsim(sys_d, x0, t, u);

stairs(sim_d.tsim, sim_d.y(:,1))
hold <span class="string">on</span>
stairs(sim_d.tsim, sim_d.x(:,2)*1e3)
legend([<span class="string">"room temperature in &deg;C"</span>, <span class="string">"room abs. humidity in kg/kg"</span>])
grid <span class="string">on</span>
axis([0 60 0 35])
hold <span class="string">off</span>
</pre>
<img vspace="5" hspace="5" src="dmsimDoc_04.png" alt=""> <p>It can be easily seen that a stepsize of 5 seconds is not sufficient for the representation of the continuous system dynamics in discrete-time. The step size should be reduced:</p>
<pre class="codeinput">Ts = 1;
sys_d2 = sys_d.d2d(Ts);

t = [0:Ts:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);

sim_d2 = dmsim(sys_d2, x0, t, u);

plot(simout.tsim, nan(length(simout.tsim), 1), <span class="string">'k--'</span>, LineWidth=1.2)
hold <span class="string">on</span>
stairs(sim_d.tsim, nan(length(sim_d.tsim), 1), <span class="string">'b:'</span>, LineWidth=0.8)
stairs(sim_d2.tsim, nan(length(sim_d2.tsim), 1), <span class="string">'r-'</span>, LineWidth=1)
plot(simout.tsim, simout.y(:,1), <span class="string">'k--'</span>, LineWidth=1.2)
plot(simout.tsim, simout.x(:,2)*1e3, <span class="string">'k--'</span>, LineWidth=1.2)
stairs(sim_d.tsim, sim_d.y(:,1), <span class="string">'b:'</span>, LineWidth=0.8)
stairs(sim_d.tsim, sim_d.x(:,2)*1e3, <span class="string">'b:'</span>, LineWidth=0.8)
stairs(sim_d2.tsim, sim_d2.y(:,1), <span class="string">'r-'</span>, LineWidth=1.2)
stairs(sim_d2.tsim, sim_d2.x(:,2)*1e3, <span class="string">'r-'</span>, LineWidth=1.2)
grid <span class="string">on</span>
legend([<span class="string">"continuous-time"</span>, <span class="string">"discrete-time: 5 sec."</span>, <span class="string">"discrete-time: 1 sec."</span>], <span class="string">"Location"</span>,<span class="string">"northeast"</span>)
hold <span class="string">off</span>
</pre>
<pre class="codeoutput">System reduced algebraicly by 2 algebraic variable(s) and 2 equation(s).
</pre>
<img vspace="5" hspace="5" src="dmsimDoc_05.png" alt=""> <h2 id="32">References</h2>
<p>[1] T. Warnecke and G. Lichtenberg, "Hybrid implicit multilinear simulation using difference algebraic equations reordering by sparsity patterns", 2024 10th International Conference on Control, Decision and Information Technologies (CoDIT), Valletta, Malta, 2024. In press.</p>
<p>[2] J. C. Sprott, &ldquo;Some simple chaotic flows,&rdquo; Physical Review E, vol. 50, no. 2, Aug. 1994. doi:10.1103/physreve.50.r647</p>
<h2 id="33">See Also</h2>
<p>
<a href="dmssDoc.html">dmss</a>, <a href="mssDoc.html">mss</a>, <a href="msimDoc.html">msim</a>, <a href="dmssc2dDoc.html">c2d</a>, <a href="d2cDoc.html">d2c</a>, <a href="d2dDoc.html">d2d</a>, <a href="normalizeDoc.html">normalize</a>, <a href="appendDoc.html">append</a>, <a href="connectDoc.html">connect</a>, <a href="https://de.mathworks.com/help/matlab/ref/odeset.html">odeset</a>, <a href="https://de.mathworks.com/help/matlab/ref/ode15i.html">ode15i</a>, <a href="https://de.mathworks.com/help/optim/ug/lsqnonlin.html">lsqnonlin()</a>
</p>
<p>Author(s): Torben Warnecke</p>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% dmsim
% simulated response of implicit/descriptor multilinear time invariant
% (iMTI) system to arbitrary input signals
%
%% Syntax
% simout = dmsim(sys, x0)
% Simulated time response of autonomous iMTI system for the time fram from 0 to 10
% and initial states x0.
%
% simout = dmsim(sys, x0, ut)
% Simulated time response of autonomous iMTI system for the time frame of ut
% and initial states x0.
%
% simout = dmsim(sys, x0, ut, u)
% Simulated time response of iMTI system with arbitrary input signals u (linear interpolated) 
% at the time steps of ut and initial states x0.
% For continuous-time simulation use default ode-settings from Matlab.
%
% simout = dmsim(sys, x0, ut, u, opt)
% Simulated time response of iMTI system with arbitrary input signals u (linear interpolated) 
% at the time steps of ut and initial states x0, with using the
% ode-settings opt (defined with opt = odeset()). Only used for
% continuous-time simulation.
%
%% Description
% The dmsim class serves as simulation class for implicit/descriptor
% multilinear time invariant (iMTI) models. Only differential index-1
% systems are usable.
% The simulation will be performed automatically when creating a dmsim
% object by simout = dmsim(sys, x0, ut, u).
%
% For continuous-time simulations Matlabs implementation of the variable
% order method ode15i() will be used.
% For discrete-time simulations an automated tearing approach will be used,
% described in [1],
% where the set of equations will be split into multiple subsets and explicit solvable subsets of equations will be identified, as well as implicit
% solvable subsets. For reordering the sparsity pattern, Matlabs implementation of the dulmage-mendelsohn decomposition dmperm() is used. 
% The implicit solvable subsets will be solved using the Levenberg-Marquardt algorithm implementation of Matlabs
% nonlinear least-squares solver lsqnonlin().
%
%% Examples
%
% *Autonomous continuous-time simulation (including ode-settings): Sprott B Attractor*
%
% In [2] J. C. Sprott proposed chaotic attractor named Sprott A-S systems. 
% The Sprott B attractor is described by the following differential
% equations
eq = ["dx1 = a*x2*x3";...
    "dx2 = x1 - b*x2";...
    "dx3 = c - x1*x2"];
%%
% The dmss model can be directly generated using the symbolic equations by
Ts = 0;
sys = sym2dmss(eq, Ts, ["dx", "x", "u", "y"]);

%%
% where the timestep size is 0 for continuous time systems. Also it can be generated using the cpn-1 tensor format. Therefor first an
% empty hyCPN1() object needs to be generated, so its properties are
% accessable.
Ts = 0;
H = hyCPN1();
H.F.stateDerivative  = [1 0 0 0 0 0 0 0;...
                        0 1 0 0 0 0 0 0;...
                        0 0 1 0 0 0 0 0];
H.F.state = [0 0 0 0 1 0 0 1;...
             0 0 0 1 0 1 0 1;...
             0 0 0 1 0 0 0 0];
H.phi.equality =   [-1 0 0 sym("a") 0 0 0 0;...
                    0 -1 0 0 1 -sym("b") 0 0;...
                    0 0 -1 0 0 0 sym("c") -1];
sys = dmss(H,Ts);

%%
% The equations can be displayed by 
disp(sys.symbolicEquations)
%%
% where $xp_i$ are the state derivatives, $x_i$ are states (differential
% variables), $y_i$ are algebriac variables and $u_i$ are input signals.
%
% For this example the parameters 
params = [sym("a"), sym("b"), sym("c")];
%% 
% are defined as
numParams = [0.4, 1.2, 1];
%%
% The symbolic parameter values must be replace by the numeric parameter
% values for the simulation.
sys = sys.replaceSymbolicParameters(params, numParams);
%%
% The Equations can be checked again by
disp(sys.symbolicEquations)
%%
% Now the simulation can be done with creating a dmsim object with the dmss
% model as input, as well as initial states and a simulation time frame:
t = [0, 1e3];
x0 = [0.1, 0, 0];
opt = odeset('RelTol', 10.0^(-3),'AbsTol',10.0^(-7));
simout = dmsim(sys, x0, t, [], opt);
%%
% The simulation results can be accessed as the properties of the
% simulation object.
% Then the phase space can be portraited by Matlabs ploting functions
plot3(simout.x(:,1), simout.x(:,2), simout.x(:,3))
grid on 

%%
% *Continuous-time simulation with algebraic constraint: robertson problem*
%
% The robertson problem can be written as a system of DAEs, which gives
eq = ["0 = dx1 + 0.04*x1 - 10^4*x2*y1";...
    "0 = dx2 - 0.04*x1 + 10^4*x2*y1 + (3*10^7)*x2^2";...
    "0 = x1 + x2 + y1 - 1"]
%%
% As before the symbolic system of equations can be transfered into a dmss
% object by
Ts = 0;
sys = sym2dmss(eq, Ts, ["dx", "x", "u", "y"]);
disp(sys.symbolicEquations)
%%
% where $xp_i$ are the state derivatives, $x_i$ are states (differential
% variables), $y_i$ are algebriac variables and $u_i$ are input signals.
% One can see that an auxiliary variable $y_2$ and an according had been
% added due to the quadratic term.
%
% Simulation can be performed by creating a dmsim object
t = [0, 4e6];
x0 = [1, 0];
simout = dmsim(sys, x0, t);

semilogx(simout.tsim, simout.x(:,1))
hold on 
semilogx(simout.tsim, simout.x(:,2))
semilogx(simout.tsim, simout.y(:,1))
grid on 
hold off

%%
% *Continuous-time example with inputs: Simplified room model of an air conditioning system*
% 
% HVAC systems can be modeled by dynamic energy balances (power/heat flow
% balances) and dynamic transport balances. The dynamics of the air temperature, enthalpy and humidity of an air conditioned room
% can be represented by the following power balance
powerBalance = ["0 = -m*dh1 + p1 + p2"];
%%
% transport balance of the water vapor in the air
transportBalance = ["0 = -m*dh2 + p3"];
%%
% and equation for the specific enthalpy
enthalpy = ["h1 = c_d * T1 + c_v * T1 * h2 + r0 * h2"];
%%
% where h1 is the room air enthalpy, h2 is the absolute room air humidity, dh1 and dh2 are their derivatives, T1 is the room temperature, p1 is the power
% transported by the air flow of the air conditioning system (either heating or cooling the room air), p2 is the
% heat loss to the environment and p3 is the water vapor mass flow
% transported by the air flow of the air conditioning system (either humidifying
% or dehumidifying the room air).
%
% The equations can be converted into a continuous time iMTI model by
room = sym2dmss([powerBalance; transportBalance; enthalpy], 0, ["dh", "h", "p", "T"]);
%%
% The equations represented by the model can be viewed by
disp(room.symbolicEquations)
%%
% where $xp_i$ are the state derivatives, $x_i$ are states (differential
% variables), $y_i$ are algebriac variables and $u_i$ are input signals.
%
% A model for the heat and water vapor transfer by the air conditioning
% system can be generated by 
airConditioning = ["y1 = c_d*u1*u2 + c_v*u1*u2*u3 + r0*u1*u3 - u1*u4";...
                    "y2 = u1*u3 - u1*u5"];
airConditioning = sym2dmss(airConditioning, 0, ["dx", "x", "u", "y"]);
%%
% where y1 corresponds to the power transported by the air flow of the air
% conditioning system, y2 to the water vapor mass flow transported by the air
% flow of the air conditioning system, u1 to the supplied mass flow of air, u2
% to the supply temperature, u3 to the supply humidity, u4 to the rooms
% enthalpy and u5 to the rooms absolute humidity.
%
% Additionally the heat loss can be modelled by
loss = ["y1 = k*A*(u1-u2)"];
loss = sym2dmss(loss, 0, ["dx", "x", "u", "y"]);
%%
% where y1 is the heat loss, u1 is the ambient temperature and u2 is the
% rooms temperature.
%
% The models can be connected in two ways. 
% One way is using index matrices of input-state, input-algebraic and
% input-input connections. Therefore one of the models must be appended by the others.
% This can be done by
sys = append(room, airConditioning, loss);
%%
% Due to the appending the number of variables of the overall model as well
% as their index is increasing accordingly. The connection matrices must be
% produced carefully, where the first column corresponds to the input
% index and the second column to the state/algebraic signal index.
stateInputConnection = [7 1; 8 2];
algebraicInputConnection = [9 1; 1 2; 3 3; 2 4];
similarInputs = [];
sys = sys.connect(stateInputConnection, algebraicInputConnection, [], similarInputs);

disp(sys.symbolicEquations)

%%
% Another possibility is by automatic connection by variable names, where
% the connection matrices will be produced automatically by identifying
% similar variable names of state and inputs, algebraic variables and
% inputs, as well as inputs and inputs.
%
% For simulation the symbolic parameters must be replaced by numeric
% parameters.
symParameters = [sym("m"), sym("c_d"), sym("c_v"), sym("r0"), sym("A"), sym("k")];
numParameters = [9.03*11.33*3.4*1.225, 1006, 1860, 2501*10^3, 2*(9.03+11.33)*3.4 + 9.03*11.33, 3];
sys = sys.replaceSymbolicParameters(symParameters, numParameters);
%%
% The overall system can now be simulated with according input signals
t = [0:1:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);
%%
% where the initial state correspond to an initial room enthalpy of 75
% kJ/kg and initial aboslute humidity of 18 g water vapor per kg dry air, 
% and the (noisy) inputs correspond to an air flow of 500m³/h, supply temperature
% of 16°C, supply humidity of 10 g/kg and ambient temperature of 32°C.
% Simulation will be performed by
simout = dmsim(sys, x0, t, u);

plot(simout.tsim, simout.y(:,1))
hold on 
plot(simout.tsim, simout.x(:,2)*1e3)
legend(["room temperature in °C", "room abs. humidity in kg/kg"])
grid on 
axis([0 60 0 35])
hold off

%%
% For fast varying inputs it often makes sense to limit the maximum stepsize of the
% ode-solver, e.g. by opt = odeset('MaxStep', ts/2) where ts is the minimum
% step size between the inputs.
%%
% *Discrete-time simulation using c2d*
%
% The previuous system can transformed into a discrete-time iMTI model by
% using the c2d() function implemented for the dmss object, using one step forward euler discretization.
Ts = 5;
sys_d = sys.c2d(Ts);
%%
% Discrete-time simulation can be done similary to continuous-time
% simulation by creating a dmsim object. But here its important that the
% time vector for the input signal has the same stepsize as the stepsize of
% the model.
t = [0:Ts:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);

sim_d = dmsim(sys_d, x0, t, u);

stairs(sim_d.tsim, sim_d.y(:,1))
hold on 
stairs(sim_d.tsim, sim_d.x(:,2)*1e3)
legend(["room temperature in °C", "room abs. humidity in kg/kg"])
grid on 
axis([0 60 0 35])
hold off
%%
% It can be easily seen that a stepsize of 5 seconds is not sufficient for
% the representation of the continuous system dynamics in discrete-time.
% The step size should be reduced:
Ts = 1;
sys_d2 = sys_d.d2d(Ts);

t = [0:Ts:60];
x0 = [75000; 0.018];
u = [150/1.225, 18, 0.01, 32] .* ones(length(t),1);
rng(100)
u = u .* (0.9 + rand(size(u))/10);

sim_d2 = dmsim(sys_d2, x0, t, u);

plot(simout.tsim, nan(length(simout.tsim), 1), 'kREPLACE_WITH_DASH_DASH', LineWidth=1.2)
hold on
stairs(sim_d.tsim, nan(length(sim_d.tsim), 1), 'b:', LineWidth=0.8)
stairs(sim_d2.tsim, nan(length(sim_d2.tsim), 1), 'r-', LineWidth=1)
plot(simout.tsim, simout.y(:,1), 'kREPLACE_WITH_DASH_DASH', LineWidth=1.2)
plot(simout.tsim, simout.x(:,2)*1e3, 'kREPLACE_WITH_DASH_DASH', LineWidth=1.2)
stairs(sim_d.tsim, sim_d.y(:,1), 'b:', LineWidth=0.8)
stairs(sim_d.tsim, sim_d.x(:,2)*1e3, 'b:', LineWidth=0.8)
stairs(sim_d2.tsim, sim_d2.y(:,1), 'r-', LineWidth=1.2)
stairs(sim_d2.tsim, sim_d2.x(:,2)*1e3, 'r-', LineWidth=1.2)
grid on 
legend(["continuous-time", "discrete-time: 5 sec.", "discrete-time: 1 sec."], "Location","northeast")
hold off

%% References
% [1] T. Warnecke and G. Lichtenberg, "Hybrid implicit multilinear simulation using difference algebraic equations reordering by sparsity patterns", 2024 10th International Conference on Control, Decision and Information Technologies (CoDIT), Valletta, Malta, 2024. In press.
%
% [2] J. C. Sprott, “Some simple chaotic flows,” Physical Review E, vol. 50, no. 2, Aug. 1994. doi:10.1103/physreve.50.r647 

%% See Also
% <dmssDoc.html dmss>, 
% <mssDoc.html mss>,
% <msimDoc.html msim>,
% <dmssc2dDoc.html c2d>,
% <d2cDoc.html d2c>,
% <d2dDoc.html d2d>,
% <normalizeDoc.html normalize>,
% <appendDoc.html append>,
% <connectDoc.html connect>,
% <https://de.mathworks.com/help/matlab/ref/odeset.html odeset>,
% <https://de.mathworks.com/help/matlab/ref/ode15i.html ode15i>, 
% <https://de.mathworks.com/help/optim/ug/lsqnonlin.html lsqnonlin()>
%
%
% Author(s): Torben Warnecke
##### SOURCE END #####
-->
</body>
</html>
